<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title th:text="${pageTitle}">Airline Dashboard</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="../assets/js/plugin/webfont/webfont.min.js"></script>
    <script>
        WebFont.load({
            google: { families: ["Public Sans:300,400,500,600,700"] },
            custom: {
                families: [
                    "Font Awesome 5 Solid",
                    "Font Awesome 5 Regular",
                    "Font Awesome 5 Brands",
                    "simple-line-icons",
                ],
                urls: ["../assets/css/fonts.min.css"],
            },
            active: function () {
                sessionStorage.fonts = true;
            },
        });



    </script>

    <!-- CSS Files -->
    <link rel="stylesheet" href="../assets/css/bootstrap.min.css" />
    <link rel="stylesheet" href="../assets/css/plugins.min.css" />
    <link rel="stylesheet" href="../assets/css/kaiadmin.min.css" />

    <!-- CSS Just for demo purpose, don't include it in your project -->
    <link rel="stylesheet" href="../assets/css/demo.css" />
    <script>
        // Load airlines when page loads
        document.addEventListener('DOMContentLoaded', loadAirlines);
        let allAirlines = [];

        function loadAirlines() {
            fetch('http://localhost:8080/api/airlines')
                .then(response => response.json())
                .then(airlines => {
                    allAirlines = airlines; // Lưu vào biến global
                    renderAirlines(airlines); // Render airlines
                })
                .catch(error => console.error('Error:', error));
        }

        function renderAirlines(airlines) {
            const tableBody = document.getElementById('airlineTableBody');
            tableBody.innerHTML = '';

            airlines.forEach(airline => {
                // Kiểm tra status để quyết định hiển thị buttons
                const actionButtons = `
            <a href="airlineDetail.html?id=${airline.id}" class="btn btn-sm btn-primary me-1">
                <i class="fas fa-edit"></i>
            </a>
            <button class="btn btn-sm btn-danger" onclick="deleteAirline(${airline.id})" ${airline.status === 'INACTIVE' ? 'disabled' : ''}>
                <i class="fas fa-trash"></i>
            </button>
        `;

                const row = `
            <tr class="${airline.status === 'INACTIVE' ? 'table-secondary' : ''}">
                <td>${airline.id}</td>
                <td>${airline.airlineName}</td>
                <td>${airline.countryOfOperation}</td>
                <td>${formatDate(airline.foundedDate)}</td>
                <td>
                    <span class="badge ${airline.status === 'ACTIVE' ? 'bg-success' : 'bg-danger'}">
                        ${airline.status}
                    </span>
                </td>
                <td>
                    ${actionButtons}
                </td>
            </tr>
        `;
                tableBody.innerHTML += row;
            });
        }
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString();
        }

        function saveAirline() {
            const airlineId = document.getElementById('airlineId').value;
            const airline = {
                airlineName: document.getElementById('airlineName').value,
                countryOfOperation: parseInt(document.getElementById('countryOfOperation').value),
                foundedDate: document.getElementById('foundedDate').value,
                image: document.getElementById('image').value
            };

            const url = airlineId ? `http://localhost:8080/api/airlines?id=${airlineId}` : 'http://localhost:8080/api/airlines';
            const method = airlineId ? 'PUT' : 'POST';

            fetch(url, {
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(airline)
            })
                .then(response => response.json())
                .then(() => {
                    loadAirlines();
                    const modal = bootstrap.Modal.getInstance(document.getElementById('addAirlineModal'));
                    modal.hide();
                })
                .catch(error => console.error('Error:', error));
        }

        function deleteAirline(id) {
            if (confirm('Are you sure you want to delete this airline?')) {
                fetch(`http://localhost:8080/api/airlines?id=${id}`, {
                    method: 'DELETE'
                })
                    .then(() => loadAirlines())
                    .catch(error => console.error('Error:', error));
            }
        }

        // Reset form when modal is closed
        document.getElementById('addAirlineModal').addEventListener('hidden.bs.modal', function () {
            document.getElementById('airlineForm').reset();
            document.getElementById('airlineId').value = '';
            document.getElementById('modalTitle').textContent = 'Add New Airline';
        });

        function filterAirline() {
            const statusFilter = document.getElementById("bookingFilter").value; // Không cần toLowerCase() vì dùng select
            const nameFilter = document.getElementById("flightFilter").value.toLowerCase();

            const filtered = allAirlines.filter(airline => {
                const statusMatch = statusFilter === "" || airline.status === statusFilter;
                const nameMatch = nameFilter === "" ||
                    airline.airlineName.toLowerCase().includes(nameFilter);

                return statusMatch && nameMatch;
            });

            renderAirlines(filtered);
        }
    </script>
</head>

<body>
    <!-- Import sidebar từ file sideBar.html -->
    <div class="d-flex flex-row">
        <nav class="sidebar p-3">
            <h4 class="text-center dashboard-title" style="color: #575962">SkyFast</h4>
            <ul class="nav flex-column" id="sidebar-links">
                <li class="nav-item">
                    <a href="Dashboard.html" class="nav-link active" data-page="Dashboard.html">
                        <i class="fas fa-home"></i>Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a href="flightManagement.html" class="nav-link" data-page="flightManagement.html">
                        <i class="fas fa-plane"></i>Flight Management
                    </a>
                </li>
                <li class="nav-item">
                    <a href="airlineManagement.html" class="nav-link" data-page="airlineManagement.html">
                        <i class="fas fa-plane"></i>Airline Management
                    </a>
                </li>
                <li class="nav-item">
                    <a href="userlist.html" class="nav-link" data-page="userlist.html">
                        <i class="fas fa-users"></i>User Management
                    </a>
                </li>
            </ul>
        </nav>
        <!-- Phần nội dung chính -->
        <div class="container mt-4 main-content">
            <div class="content-container" style="width: 1545px;">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>Airline Management</h2>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addAirlineModal">
                        <i class="fas fa-plus"></i> Add New Airline
                    </button>
                </div>
                <!-- Bộ lọc -->
                <div class="row mb-3">
                    <div class="col-md-6">
                        <div class="input-group">
                            <span class="input-group-text">
                                <i class="fas fa-filter"></i>
                            </span>
                            <select id="bookingFilter" class="form-select" onchange="filterAirline()">
                                <option value="">All Status</option>
                                <option value="ACTIVE">ACTIVE</option>
                                <option value="INACTIVE">INACTIVE</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="input-group">
                            <span class="input-group-text">
                                <i class="fas fa-search"></i>
                            </span>
                            <input type="text" id="flightFilter" class="form-control"
                                placeholder="Search by Airline Name" oninput="filterAirline()" />
                        </div>
                    </div>
                </div>

                <!-- Airlines Table -->
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Airline Name</th>
                            <th>Country</th>
                            <th>Founded Date</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="airlineTableBody">
                        <!-- Data will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="modal fade" id="addAirlineModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">Add New Airline</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="airlineForm">
                        <input type="hidden" id="airlineId">
                        <div class="mb-3">
                            <label class="form-label">Airline Name</label>
                            <input type="text" class="form-control" id="airlineName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Country</label>
                            <input type="text" class="form-control" id="countryOfOperation" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Founded Date</label>
                            <input type="date" class="form-control" id="foundedDate" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Image URL</label>
                            <input type="file" class="form-control" id="image" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="saveAirline()">Save</button>
                </div>
            </div>
        </div>
    </div>




    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
</body>

</html>