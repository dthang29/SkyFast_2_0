<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Booking Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
</head>
<body>
  <div class="container mt-4">
    <h2 class="text-dark fw-bold">Booking List</h2>

      <!-- Bộ lọc tìm kiếm -->
    <div class="row mb-3">
      <div class="col-md-4">
        <input type="text" id="searchBookingId" class="form-control" placeholder="Search by Booking ID"/>
      </div>
      <div class="col-md-4">
        <input type="text" id="searchUserName" class="form-control" placeholder="Search by User Name"/>
      </div>
    </div>
      <select id="searchBookingStatus">
        <option value="">-- All Status --</option>
        <option value="Done">Done</option>
        <option value="Processing">Processing</option>
        <option value="Cancelled">Cancelled</option>
      </select>


    <table class="table table-bordered mt-3">
      <thead class="table-light">
        <tr>
          <th>ID</th>
          <th>User Name</th>
          <th>Booking Date</th>
          <th>Total Price</th>
          <th>Status</th>
          <th>Actions</th>
          <th>Detail Booking</th>
        </tr>
      </thead>
      <tbody id="bookingTableBody">
        <tr th:each="booking : ${bookings}">
          <td th:text="${booking.id}" class="booking-id"></td>
          <td th:text="${booking.userName}" class="user-name"> </td>
          <td th:text="${booking.bookingDate}"> </td>
          <td th:text="${booking.totalPrice}"></td>
          <td th:text="${booking.bookingStatus}" class="booking-status"></td>
          <td>
            <a th:href="@{/bookings/{id}(id=${booking.id})}" class="btn btn-primary">Update</a>
          </td>
          <td>
            <a th:href="@{/bookings/{id}/tickets(id=${booking.id})}" class="btn btn-primary">View Ticket</a>
          </td>
        </tr>
      </tbody>
    </table>

  </div>
  <div class="d-flex justify-content-end mb-3">
    <a href="/bookings/new" class="btn btn-success">Create New Booking</a>
  </div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>

  <script>
    document.querySelectorAll("#searchBookingId, #searchBookingStatus, #searchUserName").forEach(input => {
      input.addEventListener("input", filterTable);
      input.addEventListener("change", filterTable); // Cho thẻ select
    });

    function filterTable() {
      let searchId = document.getElementById("searchBookingId").value.toLowerCase();
      let searchStatus = document.getElementById("searchBookingStatus").value.toLowerCase();
      let searchUserName = document.getElementById("searchUserName").value.toLowerCase();

      document.querySelectorAll("#bookingTableBody tr").forEach(row => {
        let bookingId = row.querySelector(".booking-id").textContent.toLowerCase();
        let bookingStatus = row.querySelector(".booking-status").textContent.toLowerCase();
        let userName = row.querySelector(".user-name").textContent.toLowerCase();

        let matchesId = !searchId || bookingId.includes(searchId);
        let matchesStatus = !searchStatus || bookingStatus.includes(searchStatus);
        let matchesUserName = !searchUserName || userName.includes(searchUserName);

        row.style.display = (matchesId && matchesStatus && matchesUserName) ? "" : "none";
      });
    }
  </script>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    let filterBookingId = "[[${filterBookingId}]]";
    if (filterBookingId) {
        document.getElementById("searchBookingId").value = filterBookingId;
        document.getElementById("searchBookingId").dispatchEvent(new Event("input"));
    }
  })
</script>

</body>
</html>